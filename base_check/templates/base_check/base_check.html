{% extends 'base.html' %}

{% block content %}

{% if worksheet_number %}
    <h2>Worksheet: {{ worksheet_number }} </h2>
    <h2>Check {{ check_number }} - {{ check_description }}</h2>
{% elif form.fields  %}
    <h2>Worksheet</h2>

{% endif %}
<div class="container-fluid">
    <div class="row align-items-start">
        <div class="col">
            <form method="post" id="check">{% csrf_token %}

                {{ form.as_p }}
                <h3>Position</h3>
                {% for index in barcodes %}
                    {{ forloop.counter }}
                {% endfor %}
                <h3>Barcodes</h3>
                {{ barcodes.as_p }}
                <input class="nhsuk-button" data-module="nhsuk-button" type="submit" value="Check">
            </form>
        </div>
        <div class="col">
        </div>
        <div class="col">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Check by</th>
                        <th scope="col">Check date/time</th>
                        <th scope="col">Check pass</th>
                    </tr>
                </thead>
                <tbody>
                {% for record in check_record %}
                    <tr>
                        <th scope="row">{{ forloop.counter }}</th>
                        <td>{{ record.user }}</td>
                        <td>{{ record.dateTime_check }}</td>
                        <td>{{ record.check_pass }}</td>
                    </tr>
                {% endfor %}
                    <tr>
                </tbody>
            </table>
        </div>

    </div>
</div>
<script>
    document.getElementById('check').addEventListener('submit', function (event) {
        var barcodeInputs = document.querySelectorAll('input[name*="barcode_set-"]:not([type="hidden"])');
        var filledCount = 0;
        var totalCount = document.querySelector('[id$="set-TOTAL_FORMS').value;
        console.log(totalCount)

        barcodeInputs.forEach(function (input) {
            if (input.value.trim() !== '') {
                filledCount++;
            }
        });

        if (filledCount < totalCount) {
            var confirmation = confirm("Only " + filledCount + " of " + totalCount + " barcodes added. Are you sure you want to submit?");
            if (!confirmation) {
                event.preventDefault(); // Prevent form submission
            }
        }
    });
</script>

{% endblock content %}