{% extends 'base.html' %}

{% block content %}

{% if worksheet_number %}
    <h2>Worksheet: {{ worksheet_number }} </h2>
    <h2>Check: {{ check_number }} </h2>
{% elif form.fields  %}
    <h2>Worksheet</h2>

{% endif %}
<div class="container-fluid">
    <div class="row align-items-start">
        <div class="col">
            <form method="post" id="check">{% csrf_token %}
                {% if not worksheet_number %}
                    {{ form.as_p }}
                {% endif %}
                <h3>Barcodes</h3>
                {{ barcodes.as_p }}
                <input class="nhsuk-button" data-module="nhsuk-button" type="submit" value="Check">
            </form>
        </div>
        <div class="col">
        </div>
        <div class="col">
            <p> check record:</p>
        </div>

    </div>
</div>
<script>
    document.getElementById('check').addEventListener('submit', function (event) {
        var barcodeInputs = document.querySelectorAll('input[name*="barcode_set-"]:not([type="hidden"])');
        var filledCount = 0;
        var totalCount = document.querySelector('[id$="set-TOTAL_FORMS').value;
        console.log(totalCount)

        barcodeInputs.forEach(function (input) {
            if (input.value.trim() !== '') {
                filledCount++;
            }
        });

        if (filledCount < totalCount) {
            var confirmation = confirm("Only " + filledCount + " of " + totalCount + " barcodes added. Are you sure you want to submit?");
            if (!confirmation) {
                event.preventDefault(); // Prevent form submission
            }
        }
    });
</script>

{% endblock content %}